<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>PyWebview Demo</title>
    <link rel="stylesheet" href="./styles.css">
  </head>
  <body>
    <div class="top-bar">
    PRB to Excel
    </div>
    <div class="center">
      <div class="column">
        <div class="temp-art" style="--icon: url('./OpenDirectoryIcon.svg');"></div>
        <button class="action-button" onclick="openFileDialog()">Choose PRB Files</button>
        <button class="action-button" onclick="openDirDialog(true)">Choose PRB Files Directory</button>
      </div>
      <div class="column">
        <div class="temp-art" style="--icon: url('./TargetDirectoryIcon.svg');"></div>
        <button class="action-button" onclick="openDirDialog()">Target Directory</button>
        <button class="action-button fake">Not Clickable</button>
      </div>
      <div class="column">
        <div class="temp-art" style="--icon: url('./XLSXFileIcon.svg');"></div>
        <button class="action-button" onclick="generateExcel()">Generate Excel</button>
        <button class="action-button fake">Not Clickable</button>
      </div>
    </div>

    <script>
    let childOneIsOrange = false;
    async function openFileDialog() {
      // call Python method exposed as js_api 
      // returns true if a pdf is correctly chosen
      if(await pywebview.api.open_file_dialog())
      {
        document.querySelector('.column:nth-child(1)').classList.add('completed');
      }
    }

    async function openDirDialog(get_files_from_dir=false) {
      if(await pywebview.api.open_directory_dialog(get_files_from_dir))
      {
        if(childOneIsOrange)
        {
          document.querySelector('.column:nth-child(2)').classList.add('completed');
        }
        document.querySelector('.column:nth-child(1)').classList.add('completed');
        childOneIsOrange = true;
      }
    }

    async function generateExcel() {
      const result = await pywebview.api.generate_excel_file();
      await pywebview.api.print(typeof result);
      if (result) {
        await pywebview.api.print("true");
        document.querySelector('.column:nth-child(1)').classList.add('completed');
        document.querySelector('.column:nth-child(2)').classList.add('completed');
        document.querySelector('.column:nth-child(3)').classList.add('completed');
      } else {
        await pywebview.api.print("false");
      }
    }

    //this is for object with keys as digits from pywebview dialog return
    function makeObjIntoArray(obj) {
      let arr = [];
      Object.keys(file_obj).forEach((key) => { message.push(file_obj[key]) });
      return arr;
    }
    </script>
  </body>
</html>
