<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>PyWebview Demo</title>
    <link rel="stylesheet" href="./styles.css">
  </head>
  <body>
    <div class="top-bar">

    </div>
    <div class="center"> <!-- Contains the svg's, buttons, and output boxes, so the main section -->

      <div class="column"> <!-- Each column is a vertical section in the resulting UI -->
        <div class="temp-art"></div>
        <button class="action-button" onclick="openFileDialog()">Choose PRB Files</button>
        <button class="action-button" onclick="openDirDialog(true)">Choose PRB Files Directory</button>
        <p class="display-title" id="text-input-title"></p>
        <div class="display-text-area" id="text-input-rows"></div>
      </div>

      <div class="column">
        <div class="temp-art"></div>
        <button class="action-button" onclick="openDirDialog()">Target Directory</button>
        <button class="action-button fake">Not Clickable</button>
        <p class="display-title" id="text-destination-title"></p>
        <div class="display-text-area" id="text-destination-rows"></div>
      </div>

      <div class="column">
        <div class="temp-art"></div>
        <button class="action-button" onclick="generateExcel()">Generate Excel</button>
        <button class="action-button fake">Not Clickable</button>
      </div>

    </div>

    <script>
    async function openFileDialog() {
      // call Python method exposed as js_api
      const result = await pywebview.api.open_file_dialog();
      await pywebview.api.print(result);
      if (result[0]) {
        document.getElementById("text-input-title").innerHTML = "Choosen PRB Files:";
        clearText("text-input-rows");
        for (let res of result) {
          addRowText("text-input-rows", res);
        }
      } else {
        await pywebview.api.print("No files choosen");
      }
    }

    async function openDirDialog(get_files_from_dir=false) {
      const dir_path = await pywebview.api.open_directory_dialog(get_files_from_dir);
      if (dir_path && !get_files_from_dir) {
        document.getElementById("text-destination-title").innerHTML = "Destination Directory:";
        clearText("text-destination-rows");
        addRowText("text-destination-rows", dir_path);
      } else if (dir_path[0] && get_files_from_dir) {
        document.getElementById("text-input-title").innerHTML = "Choosen PRB Files:";
        clearText("text-input-rows");
        for (let res of dir_path) {
          addRowText("text-input-rows", res);
        }
      } else {
        await pywebview.api.print(typeof dir_path);
      }
    }

    async function generateExcel() {
      const result = await pywebview.api.generate_excel_file();
      await pywebview.api.print(typeof result);
      if (result) {
        await pywebview.api.print("true");
      } else {
        await pywebview.api.print("false");
      }
    }

    function addRowWithText(table_id, text) {
      const table_body = document.getElementById(table_id).getElementsByTagName("tbody")[0];
      const newRow = tableBody.insertRow(-1);
      const cell = newRow.insertCell(-1);
      cell.innerHTML = text;
    }

    //adds <p>'text'</p> to the innerhtml of a passed element id
    function addRowText(sec_id, text) {
      const sec = document.getElementById(sec_id);
      const last_slash_index = text.lastIndexOf("/")
      let text_anchor = "";
      if (last_slash_index !== -1) {
        text_anchor = text.slice(last_slash_index+1);
      } else {text_anchor = text;}
      sec.innerHTML += `<p title="${text}">${text_anchor}<br></p>`;
    }

    function clearText(sec_id) {
      const sec = document.getElementById(sec_id);
      sec.innerHTML = "";
    }

    //this is for object with keys as digits from pywebview dialog return
    function makeObjIntoArray(obj) {
      let arr = [];
      Object.keys(file_obj).forEach((key) => { message.push(file_obj[key]) });
      return arr;
    }
    </script>
  </body>
</html>
